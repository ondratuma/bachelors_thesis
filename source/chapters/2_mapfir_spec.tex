\chap Analysis of the mapf-IR project
In this chapter I will take a detailed look at the inner workings of \mapfIR project. The purpose of this chapter is also to point out differences in formats and inner workings that we need to migrate in order to achieve full copmatibility.

{\mapfIR} is {\uv{A simulator and visualizer of Multi-Agent Path Finding (MAPF), used in a paper "Iterative Refinement for Real-Time Multi-Robot Path Planning" (to appear at IROS-21). It is written in C++(17) with CMake (â‰¥v3.16) build. The repository uses Google Test and the original library for 2D pathfinding as git submodules. The visualizer uses openFrameworks and works only on macOS.
    }\cite[MAPFIR:REPO_DESCRIPTION]
}

\sec Introduction
{\mapfIR} consists of 2 parts. A solver and a visualizer. 
The solver is a standalone \cmake application and the visualizer is using openFrameworks as in our case. This split is necessary as described in {~\ref[choosing_gui]}.

\label[mapfir_solver]
\sec The solver
\secc{Input format}
\begtt
map_file=arena.map
agents=300
seed=0
random_problem=0
max_timestep=500
max_comp_time=30000
36,33,5,23
3,17,23,33
30,15,9,27
19,35,42,30
8,21,2,18
\endtt
The input format is as illustrated on above starting by the name of a map file on the first line, followed by the number of agents on the second, followed by the seed of the problem, followed by two time configuration options.
The next \uv{number of agents} lines are in the format sX sY gX gY where sX and sY are the x and y coordinates of the starting point, respectively, and gX, gY are the x and y coordinates of the goal, respectively. 

\label[mapfir_solver_output_format]
\secc{Output format}
\begtt
instance=instances/arena_300agents_1.txt
agents=300
map_file=arena.map
solver=IR_HYBRID
solved=1
soc=12085
lb_soc=9722
makespan=80
lb_makespan=80
comp_time=414
iter=0,comp_time=20,soc=13284,makespan=13284
...
starts=(36,33),(3,17),(30,15),(19,35),(8,21),(37,5),(20,36),(22,37),(28,14),(38,43),(28,45),(11,11),(27,43),(44,39),(23,44),(13,20),(38,15),(7,42),(29,38),(22,2),(21,41),(43,15),(37,16),(47,13),(8,9),(29,13),(33,11),(8,15),(19,47),(35,3),(14,25),(2,43),(6,45),(7,45),(33,40),(3,40),(11,16),(19,6),(37,8),(39,30),(8,6),(19,28),(45,43),(38,9),(43,2),(11,40),(24,33),(39,2),(36,7),(46,16),(1,23),(11,14),(37,42),(39,24),(4,21),(41,25),(29,42),(6,25),(34,35),(47,8),(33,39),(40,12),(26,28),(9,34),(34,46),(7,36),(26,31),(36,6),(20,40),(20,28),(22,41),(12,18),(24,21),(47,42),(39,5),(3,33),(6,41),(4,13),(12,21),(3,44),(24,4),(32,45),(43,20),(10,46),(23,42),(3,42),(11,6),(13,31),(37,3),(40,19),(39,1),(16,8),(30,24),(27,44),(36,26),(32,25),(38,7),(31,26),(20,34),(34,30),(44,26),(43,28),(14,15),(12,4),(5,41),(11,41),(39,14),(7,6),(38,17),(7,47),(17,23),(6,36),(38,19),(13,34),(39,25),(9,3),(35,1),(11,22),(38,41),(2,26),(37,32),(41,35),(25,41),(38,21),(5,34),(25,2),(22,30),(24,12),(32,13),(4,38),(4,15),(33,45),(14,7),(23,6),(8,47),(32,26),(6,42),(28,7),(33,3),(28,4),(38,23),(37,38),(26,44),(11,9),(1,39),(9,24),(39,45),(41,36),(5,27),(23,38),(45,32),(8,16),(9,19),(41,28),(14,20),(40,9),(25,27),(27,35),(5,20),(46,46),(36,9),(29,18),(18,40),(47,40),(26,12),(42,7),(25,21),(37,43),(29,26),(19,46),(29,19),(24,46),(27,40),(29,2),(2,8),(14,22),(16,44),(8,30),(42,2),(44,6),(28,32),(38,2),(31,7),(8,43),(41,7),(43,10),(33,14),(40,2),(13,1),(31,40),(18,7),(43,30),(46,8),(41,14),(2,23),(30,22),(12,13),(18,24),(12,10),(35,2),(15,27),(28,13),(13,21),(12,29),(21,4),(44,45),(29,11),(14,45),(8,26),(3,2),(40,29),(45,29),(11,32),(39,3),(26,24),(32,22),(11,44),(41,27),(22,8),(6,17),(44,27),(12,38),(30,28),(7,5),(12,20),(17,24),(4,11),(34,21),(5,32),(11,37),(30,17),(34,18),(10,17),(40,1),(38,10),(15,29),(28,26),(35,12),(14,32),(23,5),(15,43),(11,26),(39,20),(27,23),(39,21),(29,32),(35,14),(25,43),(5,37),(33,26),(4,25),(3,15),(40,36),(29,22),(23,40),(43,39),(17,9),(16,25),(6,29),(9,10),(46,42),(6,44),(14,40),(40,47),(31,24),(40,41),(26,16),(13,47),(1,43),(24,36),(43,36),(45,38),(26,14),(5,12),(19,27),(45,26),(20,38),(29,9),(20,2),(35,6),(47,23),(9,35),(7,2),(14,3),(5,44),(23,18),(20,3),(7,23),(3,9),(32,3),(4,20),(5,35),(4,27),(16,45),(7,39),(11,8),(13,33),(14,19),(22,36),(26,33),
goals=(5,23),(23,33),(9,27),(42,30),(2,18),(19,22),(41,33),(42,4),(20,42),(8,28),(37,10),(26,43),(21,6),(18,39),(39,10),(37,27),(36,46),(28,14),(35,42),(45,11),(23,3),(10,44),(4,40),(38,28),(12,20),(33,37),(7,27),(42,44),(6,1),(19,41),(9,44),(34,5),(41,26),(18,29),(13,29),(34,22),(24,19),(42,18),(34,7),(25,46),(33,26),(12,26),(28,3),(14,37),(21,37),(12,16),(45,8),(12,36),(6,17),(24,26),(23,25),(45,45),(43,8),(43,29),(45,6),(11,32),(12,3),(22,2),(44,40),(35,2),(7,6),(45,5),(29,46),(38,37),(11,16),(40,30),(46,16),(3,7),(47,14),(46,9),(46,38),(42,20),(43,1),(13,7),(24,22),(30,43),(14,21),(9,2),(22,41),(44,22),(9,4),(2,45),(13,20),(20,20),(41,22),(34,6),(8,9),(31,8),(18,4),(42,29),(21,45),(23,20),(16,22),(11,33),(4,26),(40,43),(33,10),(19,13),(7,42),(27,15),(6,5),(43,33),(17,7),(45,7),(38,22),(10,15),(11,13),(37,19),(5,27),(12,45),(33,27),(35,22),(37,36),(10,16),(34,11),(12,12),(10,36),(31,42),(36,3),(31,11),(39,35),(18,3),(13,1),(16,28),(46,27),(44,16),(18,8),(40,23),(30,1),(32,10),(11,31),(38,19),(6,8),(18,38),(40,14),(19,11),(37,39),(30,32),(12,39),(11,20),(33,6),(15,20),(33,5),(30,2),(2,14),(45,34),(36,43),(4,9),(18,7),(21,24),(40,15),(27,31),(35,31),(22,43),(41,28),(26,12),(10,33),(9,10),(5,28),(14,25),(1,30),(38,39),(44,37),(13,41),(16,30),(32,6),(15,44),(43,2),(10,32),(20,21),(46,37),(45,43),(3,28),(27,41),(4,37),(41,40),(41,36),(47,42),(28,19),(28,23),(40,31),(41,46),(47,36),(8,15),(42,32),(7,10),(14,4),(12,15),(45,10),(34,37),(34,13),(5,32),(39,15),(34,26),(2,39),(36,25),(8,34),(12,10),(4,3),(9,34),(22,31),(21,30),(26,22),(28,43),(46,42),(27,21),(40,21),(16,5),(19,12),(6,30),(19,47),(45,30),(27,18),(45,28),(25,3),(41,41),(42,13),(39,39),(22,15),(25,10),(5,41),(3,17),(24,3),(42,12),(29,26),(32,5),(38,33),(44,34),(22,42),(16,45),(31,4),(7,46),(11,17),(18,22),(36,24),(15,40),(33,39),(15,26),(7,28),(43,32),(13,39),(3,2),(35,25),(15,35),(18,35),(22,26),(14,45),(20,29),(9,35),(36,28),(17,12),(5,25),(39,18),(30,30),(7,30),(42,10),(23,36),(5,2),(21,44),(14,20),(20,4),(37,2),(30,9),(3,4),(13,36),(30,33),(31,14),(20,28),(46,47),(33,42),(4,38),(13,21),(7,21),(44,12),(6,2),(23,42),(26,21),(24,46),(25,17),(38,27),(6,42),(14,29),(8,24),(39,26),(28,9),(26,39),(32,20),(27,7),(47,12),(14,13),(12,18),(38,32),(13,30),(28,18),(37,24),(1,39),(33,30),(28,16),(22,27),(30,5),
solution=
0:(36,33),(3,17),(30,15),(19,35),...
...
80:(5,23),(23,33),(9,27),(42,30),...


\endtt
The output format is as illustrated above with the important information being the number of agents on row 2, followed by starts coordinates on row 13 in format (x1, y1), (x2, y2)... (x[number of agents], y300[number of agents]),  where x and y are the respective coordinates for each agent identified by the index of its coordinates on the row. Followed by goals in the same format. Following are [makespan] lines each representing a single discrete timestep in the simulation, where each line has the coordinates of each agent in the above-mentioned format.

\secc{General format expectations}
All positional data is assuming a grid representation of the simulated map. The representation of the data expects the coordinate (0, 0) to be the top-left corner of the simulation grid, while (xm - 1, ym - 1) is expected to be the bottom-right corner of the grid, where xm, ym is the number of columns and rows in the simulation grid, respectively.

\sec The visualizer
The visualizer uses input file conforming to the format described in {~\ref[mapfir_solver_output_format]} to visualize the run of the generated simulation. It lets the user change the simulations speed and move through discrete time steps. Other features include selecting only single agent to display, stopping agent during the simulation and visual features such as hiding/showing of lines to goals.
\mapfirGui 

\sec Benefits 
The benefits of the format used by mapfIR are mainly
\begitems \style x
    * Human readability
    * Simple parsing
    * Ability to use community solvers
\enditems
Additionally, I believe that switching to a standardized IO format will enable more students to use the demonstrator, and eventually introduce new use-cases, that were not possible before due to the inaccessibility of the demonstrator. It might greatly increase the attractiveness of the field for students developing algorithms for path finding.